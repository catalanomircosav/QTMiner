<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.*?>

<BorderPane xmlns="http://javafx.com/javafx/23"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="gui.controller.MainController"
            stylesheets="@/css/app.css">

    <!-- ========================= SIDEBAR (LEFT) ========================= -->
    <left>
        <VBox spacing="8" prefWidth="260" styleClass="sidebar">

            <!-- ===== Connessione ===== -->
            <TitledPane text="Connessione" expanded="true" styleClass="sidebar-group">
                <VBox spacing="6">
                    <padding><Insets top="8" right="8" bottom="8" left="8"/></padding>

                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Host:"/>
                        <TextField fx:id="hostField" promptText="localhost" HBox.hgrow="ALWAYS"/>
                    </HBox>

                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Porta:"/>
                        <TextField fx:id="portField" promptText="8080" HBox.hgrow="ALWAYS"/>
                    </HBox>

                    <HBox spacing="10" alignment="CENTER">
                        <Button text="Connetti" onAction="#onConnect"/>
                        <Button text="Disconnetti" onAction="#onDisconnect"/>
                    </HBox>

                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Stato:"/>
                        <Label fx:id="statusLabel" text="Non connesso"/>
                    </HBox>
                </VBox>
            </TitledPane>

            <!-- ===== Database ===== -->
            <TitledPane text="Database" expanded="true" styleClass="sidebar-group">
                <VBox spacing="6">
                    <padding><Insets top="8" right="8" bottom="8" left="8"/></padding>

                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Tabella:"/>
                        <TextField fx:id="tableNameField" promptText="Nome tabella" HBox.hgrow="ALWAYS"/>
                    </HBox>

                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Raggio:"/>
                        <Slider fx:id="radiusSlider" min="0.1" max="5.0" value="0.5"
                                majorTickUnit="0.5" showTickLabels="true" showTickMarks="true"
                                blockIncrement="0.1" HBox.hgrow="ALWAYS"/>
                        <TextField fx:id="radiusField" text="0.5" prefWidth="60"/>
                    </HBox>

                    <HBox spacing="10" alignment="CENTER">
                        <Button text="Carica tabella" onAction="#onLoadTable"/>
                        <Button text="Cluster DB" onAction="#onClusterFromDB"/>
                    </HBox>
                </VBox>
            </TitledPane>

            <!-- ===== File ===== -->
            <TitledPane text="File" expanded="true" styleClass="sidebar-group">
                <VBox spacing="6">
                    <padding><Insets top="8" right="8" bottom="8" left="8"/></padding>

                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Tabella:"/>
                        <TextField fx:id="fileTableField" promptText="Nome tabella" HBox.hgrow="ALWAYS"/>
                    </HBox>

                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="Raggio:"/>
                        <Slider fx:id="fileRadiusSlider" min="0.1" max="5.0" value="0.5"
                                majorTickUnit="0.5" showTickLabels="true" showTickMarks="true"
                                blockIncrement="0.1" HBox.hgrow="ALWAYS"/>
                        <TextField fx:id="fileRadiusField" text="0.5" prefWidth="60"/>
                    </HBox>

                    <HBox spacing="10" alignment="CENTER">
                        <Button text="Cluster da file" onAction="#onClusterFromFile"/>
                        <Button text="Salva cluster" onAction="#onSaveClusters"/>
                    </HBox>
                </VBox>
            </TitledPane>
        </VBox>
    </left>

    <!-- ========================= CENTRO (MAIN CONTENT) ========================= -->
    <center>
        <VBox spacing="10">
            <padding><Insets top="12" right="12" bottom="12" left="12"/></padding>

            <!-- Tabs principali -->
            <TabPane tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS">

                <!-- ===== Dataset Tab ===== -->
                <Tab text="Dataset">
                    <VBox spacing="12">
                        <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                        <Label text="Anteprima dati caricati" styleClass="section-title"/>
                        <TableView fx:id="dataTable" VBox.vgrow="ALWAYS"/>
                    </VBox>
                </Tab>

                <!-- ===== Clustering Tab ===== -->
                <Tab text="Clustering">
                    <VBox spacing="12">
                        <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>

                        <Label text="Distribuzione e punti cluster" styleClass="section-title"/>
                        <!-- Selezione assi -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="Asse X:"/>
                            <ChoiceBox fx:id="xAxisChoice" prefWidth="150"/>
                            <Label text="Asse Y:"/>
                            <ChoiceBox fx:id="yAxisChoice" prefWidth="150"/>
                        </HBox>

                        <!-- Grafici -->
                        <HBox spacing="10" VBox.vgrow="ALWAYS">
                            <BarChart fx:id="clusterBarChart" HBox.hgrow="ALWAYS">
                                <xAxis><CategoryAxis label="Cluster"/></xAxis>
                                <yAxis><NumberAxis label="Dimensione"/></yAxis>
                            </BarChart>
                            <ScatterChart fx:id="clusterScatterChart" HBox.hgrow="ALWAYS">
                                <xAxis><NumberAxis label="X"/></xAxis>
                                <yAxis><NumberAxis label="Y"/></yAxis>
                            </ScatterChart>
                        </HBox>

                        <Label text="Dettagli cluster" styleClass="section-title"/>
                        <TableView fx:id="clustersTable" prefHeight="160" VBox.vgrow="NEVER">
                            <columns>
                                <TableColumn text="Cluster" fx:id="clusterNameCol" prefWidth="90"/>
                                <TableColumn text="Centroide" fx:id="centroidCol" prefWidth="320"/>
                                <TableColumn text="Dimensione" fx:id="sizeCol" prefWidth="100"/>
                                <TableColumn text="Avg Distance" fx:id="avgDistanceCol" prefWidth="120"/>
                            </columns>
                        </TableView>

                        <Label text="Esempi per cluster" styleClass="section-title"/>
                        <TableView fx:id="examplesTable" prefHeight="280" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn text="Cluster" fx:id="exClusterCol" prefWidth="100"/>
                                <TableColumn text="Esempio" fx:id="exExampleCol" prefWidth="620"/>
                                <TableColumn text="Distanza" fx:id="exDistCol" prefWidth="120"/>
                            </columns>
                        </TableView>
                    </VBox>
                </Tab>

                <!-- ===== Log Tab ===== -->
                <Tab text="Log">
                    <VBox spacing="8">
                        <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                        <HBox alignment="CENTER_RIGHT" spacing="10">
                            <Label text="Eventi recenti" styleClass="section-title" HBox.hgrow="ALWAYS"/>
                            <Button text="Pulisci log" onAction="#onClearLog"/>
                        </HBox>
                        <TextArea fx:id="logArea" editable="false" wrapText="true" VBox.vgrow="ALWAYS"/>
                    </VBox>
                </Tab>
            </TabPane>
        </VBox>
    </center>

    <!-- ========================= FOOTER ========================= -->
    <bottom>
        <HBox alignment="CENTER_RIGHT">
            <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
            <Label text="Â© 2025 QTMiner FX" styleClass="footer-label"/>
        </HBox>
    </bottom>
</BorderPane>